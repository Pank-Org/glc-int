{
	"info": {
		"_postman_id": "10497157-aa71e25a-52c1-4266-b029-4d0f125ca53b",
		"name": "[Monitor] [Sanity] API Specification service",
		"description": "Debugging steps if you see failures in this reported via the monitors:\n\n[https://whimsical.com/triage-monitor-failures-868kMPybZfPsAxrrT8NF62](https://whimsical.com/triage-monitor-failures-868kMPybZfPsAxrrT8NF62)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Create & fetch spec",
			"item": [
				{
					"name": "Create Spec",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "6ade5824-ebf0-4924-b10f-5dd1db5683b2",
								"exec": [
									"try {",
									"    const {retryOnFailure} = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 201\", function () {",
									"        pm.response.to.have.status(201);",
									"    });",
									"",
									"    if (pm.response.code !== 201)  {",
									"        throw 'StatusCode: ' + pm.response.code;",
									"    }",
									"",
									"    pm.test(\"Response is an object with meta and data properties\", function () {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.be.an('object');",
									"        pm.expect(jsonData).to.have.property('meta');",
									"        pm.expect(jsonData).to.have.property('data');",
									"    });",
									"",
									"    pm.test(\"Schema is valid\", function () {",
									"        var schema = {",
									"            type: \"object\",",
									"            properties: {",
									"                meta: {",
									"                    type: \"object\",",
									"                    properties: {",
									"                        action: { type: \"string\" },",
									"                        model: { type: \"string\" }",
									"                    }",
									"                },",
									"                data: {",
									"                    type: \"object\",",
									"                    properties: {",
									"                        id: { type: \"string\" },",
									"                        name: { type: \"string\" },",
									"                        type: { type: \"string\" },",
									"                        createdBy: { type: \"string\" },",
									"                        updatedBy: { type: \"string\" },",
									"                        description: { type: \"string\" },",
									"                        updatedAt: { type: \"string\" },",
									"                        createdAt: { type: \"string\" }",
									"                    },",
									"                    required: [\"id\", \"name\", \"type\", \"createdBy\", \"updatedBy\", \"description\", \"updatedAt\", \"createdAt\"]",
									"                }",
									"            },",
									"            required: [\"meta\", \"data\"]",
									"        };",
									"",
									"        var response = pm.response.json();",
									"        pm.expect(tv4.validate(response, schema)).to.be.true;",
									"",
									"        // set spec Id",
									"        pm.environment.set(\"specificationId1\", response.data.id);",
									"",
									"        console.log('Specification ID:', response.data.id);",
									"    });",
									"",
									"    // Retrieve the saved \"id\" value from the variable",
									"    pm.test(\"Validate response against saved 'id' value\", function () {",
									"        var savedName = \"Spec1\";",
									"        var savedType = \"OPENAPI:3.0\";",
									"        var responseBody = pm.response.json();",
									"        var { name, type } = responseBody.data;",
									"",
									"        pm.expect(name).to.equal(savedName);",
									"        pm.expect(type).to.equal(savedType);",
									"    });",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"",
									"    pm.execution.setNextRequest(null);",
									"}"
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "3c61e02d-ab91-4f8a-bca3-45ede0f39010",
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"id": "10497157-6e9b86f5-4b10-4e1a-ae4a-5059f566926f",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"post\",\n    \"path\": \"/specifications\",\n    \"query\": {\n        \"containerType\": \"workspace\",\n        \"containerId\": \"{{workspaceId}}\"\n    },\n    \"body\": {\n        \"name\": \"Spec1\",\n        \"description\": \"this is a demo API\",\n        \"type\": \"OPENAPI:3.0\",\n        \"files\": [\n            {\n                \"path\": \"index.yml\",\n                \"content\": \"openapi: '3.0.0'\\ninfo:\\n  version: '1.0.0'\\n  title: 'Sample API'\\n  description: Buy or rent spacecrafts\\n\\npaths:\\n  /spacecrafts/{spacecraftId}:\\n    parameters:\\n      - name: spacecraftId\\n        description: The unique identifier of the spacecraft\\n        in: path\\n        required: true\\n        schema:\\n          $ref: '#/components/schemas/SpacecraftId'\\n    get:\\n      summary: Read a spacecraft\\n      responses:\\n        '200':\\n          description: The spacecraft corresponding to the provided spacecraftId\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Spacecraft'\\n        404:\\n          description: No spacecraft found for the provided spacecraftId\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Error'\\n        500:\\n          description: Unexpected error\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Error'\\ncomponents:\\n  schemas:\\n    SpacecraftId:\\n      description: The unique identifier of a spacecraft\\n      type: string\\n    Spacecraft:\\n      type: object\\n      required:\\n        - id\\n        - name\\n        - type\\n      properties:\\n        id:\\n          $ref: '#/components/schemas/SpacecraftId'\\n        name:\\n          type: string\\n        type:\\n          type: string\\n          enum:\\n            - capsule\\n            - probe\\n            - satellite\\n            - spaceplane\\n            - station\\n        description:\\n          type: string\\n    Error:\\n      type: object\\n      required:\\n        - message\\n      properties:\\n        message:\\n          description: A human readable error message\\n          type: string\\n  securitySchemes:\\n    ApiKey:\\n      type: apiKey\\n      in: header\\n      name: X-Api-Key\\nsecurity:\\n  - ApiKey: []\",\n                \"type\": \"ROOT\"\n            }\n        ]\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "List Specs",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "975a728d-43ad-4485-916a-30146648b463",
								"exec": [
									"const Ajv = require('ajv');",
									"",
									"try {",
									"    const {retryOnFailure} = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test(\"Schema is valid\", function () {",
									"        console.log(pm.response.json());",
									"        var schema = {",
									"            type: \"object\",",
									"            properties: {",
									"                meta: {",
									"                    type: \"object\",",
									"                    properties: {",
									"                        action: { type: \"string\" },",
									"                        model: { type: \"string\" },",
									"                        cursor: {",
									"                            type: \"object\",",
									"                            properties: {",
									"                                next: { type: [\"string\", \"null\"] }",
									"                            },",
									"                            required: [\"next\"]",
									"                        }",
									"                    },",
									"                    required: [\"action\", \"model\", \"cursor\"]",
									"                },",
									"                data: {",
									"                    type: \"array\",",
									"                    items: {",
									"                        type: \"object\",",
									"                        properties: {",
									"                            id: { type: \"string\" },",
									"                            type: { type: \"string\" },",
									"                            name: { type: \"string\" },",
									"                            description: { type: [\"string\", \"null\"]},",
									"                            createdBy: { type: \"string\" },",
									"                            updatedBy: { type: \"string\" },",
									"                            createdAt: { type: \"string\" },",
									"                            updatedAt: { type: \"string\" }",
									"                        },",
									"                        required: [\"id\", \"type\", \"name\", \"description\", \"createdBy\", \"updatedBy\", \"createdAt\", \"updatedAt\"]",
									"                    }",
									"                }",
									"            },",
									"            required: [\"meta\", \"data\"]",
									"        };",
									"",
									"        var response = pm.response.json();",
									"        const validator = new Ajv({logger: console, allErrors: true});",
									"        console.log(validator.validate(schema, response), validator.errors)",
									"        pm.expect(validator.validate(schema, response)).to.be.true;",
									"    });",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-7edaa839-f059-492f-be93-f045f8be2633",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "",
								"value": ""
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"get\",\n    \"path\": \"/specifications\",\n    \"query\": {\n        \"containerType\": \"workspace\",\n        \"containerId\": \"{{workspaceId}}\",\n        \"limit\": 10\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							],
							"query": [
								{
									"key": "cursor",
									"value": "eyJvcmRlckJ5IjpbeyJwaXZvdCI6ImNyZWF0ZWRBdCIsInNjaGVtZSI6IkRFU0MiLCJ2YWx1ZSI6IjIwMjQtMDItMjNUMTI6MzQ6MzQuMDAwWiJ9LHsicGl2b3QiOiJpZCIsInNjaGVtZSI6IkRFU0MiLCJ2YWx1ZSI6ImI5ZGExZWI4LTIzMjUtNDEzOS1iM2Y2LWE3NjQ5MDNlMTNlOCJ9XSwiZGlyZWN0aW9uIjoibmV4dCJ9",
									"disabled": true
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "List One Spec",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "08ee2bf6-fa1d-4fc8-b98f-36b00ebeeef2",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test(\"Response is an object with meta and data properties\", function () {",
									"            var jsonData = pm.response.json();",
									"            pm.expect(jsonData).to.be.an('object');",
									"            pm.expect(jsonData).to.have.property('meta');",
									"            pm.expect(jsonData).to.have.property('data');",
									"        });",
									"",
									"    pm.test(\"Schema is valid\", function () {",
									"        var schema = {",
									"            type: \"object\",",
									"            properties: {",
									"                meta: {",
									"                    type: \"object\",",
									"                    properties: {",
									"                        action: { type: \"string\" },",
									"                        model: { type: \"string\" }",
									"                    }",
									"                },",
									"                data: {",
									"                    type: \"object\",",
									"                    properties: {",
									"                        id: { type: \"string\" },",
									"                        name: { type: \"string\" },",
									"                        type: { type: \"string\" },",
									"                        createdBy: { type: \"string\" },",
									"                        updatedBy: { type: \"string\" },",
									"                        description: { type: \"string\" },",
									"                        updatedAt: { type: \"string\" },",
									"                        createdAt: { type: \"string\" }",
									"                    },",
									"                    required: [\"id\", \"name\", \"type\", \"createdBy\", \"updatedBy\", \"description\", \"updatedAt\", \"createdAt\"]",
									"                }",
									"            },",
									"            required: [\"meta\", \"data\"]",
									"        };",
									"",
									"        var response = pm.response.json();",
									"        pm.expect(tv4.validate(response, schema)).to.be.true;",
									"    });",
									"",
									"    pm.test(\"Validate response against saved 'id' value\", function () {",
									"        var savedId = pm.environment.get(\"specificationId1\");",
									"",
									"        var responseBody = pm.response.json(),",
									"            responseId = responseBody.data.id;",
									"",
									"        pm.expect(responseId).to.be.eql(savedId);",
									"    });",
									"",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-dd4abcab-18c3-4212-825b-05aa6277e1c2",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "",
								"value": ""
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"get\",\n    \"path\": \"/specifications/{{specificationId1}}\",\n    \"query\": {\n        \"containerType\": \"workspace\",\n        \"containerId\": \"{{workspaceId}}\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Fetch tree",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "d086b701-1772-4328-9b70-ec702d7c0ee0",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test(\"Response has the required meta object\", function () {",
									"        const responseData = pm.response.json();",
									"",
									"        pm.expect(responseData).to.be.an('object');",
									"        pm.expect(responseData.meta).to.exist.and.to.be.an('object');",
									"        pm.expect(responseData.meta.action).to.exist;",
									"        pm.expect(responseData.meta.model).to.exist;",
									"        pm.expect(responseData.meta.cursor).to.exist.and.to.be.an('object');",
									"    });",
									"",
									"",
									"    pm.test(\"Each data object contains the required fields\", function () {",
									"        const responseData = pm.response.json();",
									"",
									"        pm.expect(responseData.data).to.be.an('array');",
									"",
									"        responseData.data.forEach(function (dataObj) {",
									"            pm.expect(dataObj).to.include.all.keys('content', 'path', 'name', 'id', 'fileType', 'type');",
									"        });",
									"    });",
									"",
									"",
									"    pm.test(\"Cursor object contains a next property\", function () {",
									"        const responseData = pm.response.json();",
									"",
									"        pm.expect(responseData.meta.cursor).to.exist;",
									"        pm.expect(responseData.meta.cursor.next).to.be.null;",
									"    });",
									"",
									"",
									"    pm.test(\"File type is in a valid format\", function () {",
									"        const responseData = pm.response.json();",
									"",
									"        pm.expect(responseData).to.be.an('object');",
									"        responseData.data.forEach(function (item) {",
									"            pm.expect(item.fileType).to.match(/[a-zA-Z]+/, \"File type should be a valid format\");",
									"        });",
									"",
									"        // save file id for update file API",
									"        const fileId = responseData.data[0].id;",
									"        pm.environment.set(\"fileId\", fileId);",
									"    });",
									"} catch (err) {",
									"    console.log('Error:', err);",
									"    console.log('Response Body', pm.response.text());",
									"}"
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-e36e58b6-e0ad-4d04-aa9a-80f5cab6a700",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"get\",\n    \"path\": \"/specifications/{{specificationId1}}/tree\",\n    \"query\": {\n        \"fields\": \"content,path,name,id,fileType,type\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				}
			],
			"id": "10497157-b05a3b06-380f-4589-bba6-400a3490fe9f"
		},
		{
			"name": "Collection generation",
			"item": [
				{
					"name": "Generate collection",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "bcfe8dbc-4294-4c48-b96b-59d7692728e4",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 202\", function () {",
									"        pm.response.to.have.status(202);",
									"    });",
									"",
									"",
									"    if (pm.response.code !== 202)  {",
									"        throw 'StatusCode: ' + pm.response.code;",
									"    }",
									"",
									"    pm.test(\"Response has the required fields - 'meta' and 'data'\", function () {",
									"        const responseData = pm.response.json();",
									"        ",
									"        pm.expect(responseData).to.be.an('object');",
									"        pm.expect(responseData).to.have.property('meta');",
									"        pm.expect(responseData).to.have.property('data');",
									"    });",
									"",
									"",
									"    pm.test(\"TaskId in the response data is a non-empty string\", function () {",
									"        const responseData = pm.response.json();",
									"        ",
									"        pm.expect(responseData.data.taskId).to.be.a('string').and.to.have.lengthOf.at.least(1, \"TaskId should be a non-empty string\");",
									"",
									"        pm.environment.set(\"taskId\", responseData.data.taskId);",
									"    });",
									"",
									"",
									"    pm.test(\"Content type is application/json\", function () {",
									"        pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");",
									"    });",
									"    ",
									"",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"    pm.execution.setNextRequest('Add folder');",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-bab1a00f-42df-47b9-84fb-1a21723b832e",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"post\",\n    \"path\": \"/specifications/{{specificationId1}}/collections\",\n    \"body\": {\n        \"name\": \"C1\",\n        \"options\": {\n            \"enableOptionalParameters\": true,\n            \"folderStrategy\": \"Tags\"\n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "List generation task status - until finished",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "54599cd9-5e54-4021-8dcc-a3d574219300",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Response status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test(\"Generation is successful\", function () {",
									"        var response = pm.response.json();",
									"        pm.expect(response).to.have.property('meta');",
									"        pm.expect(response).to.have.property('data');",
									"        pm.expect(response.meta).to.be.an('object').that.has.property('model').is.equal('Task');",
									"        pm.expect(response.meta).to.be.an('object').that.has.property('action').is.equal('list');",
									"        pm.expect(response.data).to.be.an('object').that.has.property(pm.environment.get('taskId'));",
									"",
									"        const currentRetryCount = Number(pm.environment.get('generationStatusRetryCount'));",
									"",
									"        console.log('retryCount',currentRetryCount );",
									"",
									"        if ( currentRetryCount > 5) {",
									"            console.log('Exceeded retries');",
									"",
									"            throw 'Exceeded retries';",
									"        } else if (response.data[pm.environment.get('taskId')] === 'in-progress') {",
									"            pm.environment.set('generationStatusRetryCount', currentRetryCount + 1);",
									"",
									"            pm.execution.setNextRequest('List generation task status - until finished');",
									"        } else if (response.data[pm.environment.get('taskId')] === 'failed') {",
									"            throw 'Status: failed';",
									"        }",
									"    });",
									"} catch (err) {",
									"    console.log('Error:', err);",
									"    console.log('Response Body', pm.response.text());",
									"    ",
									"    pm.execution.setNextRequest('Add folder');",
									"} finally {",
									"    pm.environment.set('generationStatusRetryCount', 0);",
									"}"
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "a496ee32-6ef5-447b-b942-d0157109d83e",
								"exec": [
									"setTimeout(function() {}, 1000);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"id": "10497157-186b8915-5e37-4746-a1f6-031b12c1bbdc",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"get\",\n    \"path\": \"/tasks?entityId={{specificationId1}}&entityType=specification&type=collection-generation\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						},
						"description": "Assert task staus to be successful"
					},
					"response": []
				},
				{
					"name": "List generated collections",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "11f600f6-875f-462e-b48b-4fccaf9966e9",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Response status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test(\"Success response\", function () {",
									"        var response = pm.response.json();",
									"        pm.expect(response).to.have.property('meta');",
									"        pm.expect(response.meta).to.have.property('cursor');",
									"        pm.expect(response.meta.cursor).to.have.property('next');",
									"",
									"        pm.expect(response).to.have.property('data');",
									"        pm.expect(response.meta).to.be.an('object').that.has.property('model');",
									"        pm.expect(response.meta).to.be.an('object').that.has.property('action');",
									"        pm.expect(response.data).to.be.an('array').that.has.length(1);",
									"",
									"        pm.expect(response.data[0]).to.be.an('object').that.has.property('state').is.equal('in-sync');",
									"",
									"        // Set the collectionId as variable",
									"        pm.environment.set('collectionId', response.data[0].collection);",
									"    });",
									"} catch (err) {",
									"    console.log('Error:', err);",
									"    console.log('Response Body', pm.response.text());",
									"    pm.execution.setNextRequest('Add folder');",
									"}"
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-4e9d69bb-e01f-4966-9491-20d316b88b56",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"get\",\n    \"path\": \"/specifications/{{specificationId1}}/collections\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				}
			],
			"id": "10497157-84a39131-d650-4334-b2b1-9d284b923b07"
		},
		{
			"name": "File & Folder create,update",
			"item": [
				{
					"name": "Add folder",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "5d66aab6-5ba4-4335-a2ba-49945b88a152",
								"exec": [
									"try {    ",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 201\", function () {",
									"        pm.response.to.have.status(201);",
									"    });",
									"",
									"    if (pm.response.code !== 201)  {",
									"        throw 'StatusCode: ' + pm.response.code;",
									"    }",
									"",
									"    pm.test('Response body is valid', function () {",
									"        const jsonData = pm.response.json();",
									"",
									"        pm.expect(jsonData).to.be.an('object');",
									"        pm.expect(jsonData).to.have.all.keys(['meta', 'data']);",
									"    });",
									"",
									"    pm.test(\"Response body.meta is valid\", function () {",
									"        const jsonData = pm.response.json();",
									"",
									"        pm.expect(jsonData.meta).to.be.an('object');",
									"        pm.expect(jsonData.meta).to.have.property('model', 'SpecificationFolder');",
									"        pm.expect(jsonData.meta).to.have.property('action', 'create');",
									"    });",
									"",
									"    pm.test(\"Response body.data is valid\", function () {",
									"        var jsonData = pm.response.json();",
									"",
									"        pm.expect(jsonData.data).to.be.an('object');",
									"        pm.expect(jsonData.data).to.have.all.keys(['id', 'name', 'createdBy', 'updatedBy', 'createdAt', 'updatedAt']);",
									"",
									"        pm.environment.set(\"spec1FolderId1\", jsonData.data.id);",
									"    });",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-e674bf32-d4d8-4f4f-8cc2-57e43a4d2879",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"post\",\n    \"path\": \"/specifications/{{specificationId1}}/folders\",\n    \"body\": {\n        \"name\": \"folder1\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Update folder",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "7b599236-f79f-446f-9aa3-c2c1ae7d289f",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"",
									"    pm.test(\"Status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test('Response body is valid', function () {",
									"        const jsonData = pm.response.json();",
									"",
									"        pm.expect(jsonData).to.be.an('object');",
									"        pm.expect(jsonData).to.have.all.keys(['meta', 'data']);",
									"    });",
									"",
									"    pm.test(\"Response body.meta is valid\", function () {",
									"        const jsonData = pm.response.json();",
									"",
									"        pm.expect(jsonData.meta).to.be.an('object');",
									"        pm.expect(jsonData.meta).to.have.property('model', 'SpecificationFolder');",
									"        pm.expect(jsonData.meta).to.have.property('action', 'patch');",
									"    });",
									"",
									"    pm.test(\"Response body.data is valid\", function () {",
									"        var jsonData = pm.response.json();",
									"",
									"        pm.expect(jsonData.data).to.be.an('object');",
									"        pm.expect(jsonData.data).to.have.all.keys('id');",
									"    });",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-f9bc09ca-7e84-4597-a3f4-4825fb965c0f",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"patch\",\n    \"path\": \"/specifications/{{specificationId1}}/folders/{{spec1FolderId1}}\",\n    \"body\": [\n        {\n            \"op\": \"replace\",\n            \"path\": \"/name\",\n            \"value\": \"folder1Updated\"\n        }\n    ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Add file",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "3ccc6f02-22a0-4890-80ca-d7bcbe9cdb32",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    if (pm.response.code !== 201) {",
									"        throw 'StatusCode: ' + pm.response.code;",
									"    }",
									"",
									"    pm.test(\"Schema is valid\", function () {",
									"        var schema = {",
									"            type: \"object\",",
									"            properties: {",
									"                meta: {",
									"                    type: \"object\",",
									"                    properties: {",
									"                        model: { type: \"string\" },",
									"                        action: { type: \"string\" }",
									"                    },",
									"                    required: [\"model\", \"action\"]",
									"                },",
									"                data: {",
									"                    type: \"object\",",
									"                    properties: {",
									"                        id: { type: \"string\" },",
									"                        name: { type: \"string\" },",
									"                        createdBy: { type: \"string\" },",
									"                        updatedBy: { type: \"string\" },",
									"                        createdAt: { type: \"string\" },",
									"                        updatedAt: { type: \"string\" }",
									"                    },",
									"                    required: [\"id\", \"name\", \"createdBy\", \"updatedBy\", \"createdAt\", \"updatedAt\"]",
									"                }",
									"            },",
									"            required: [\"meta\", \"data\"]",
									"        };",
									"",
									"        var response = pm.response.json();",
									"        pm.expect(tv4.validate(response, schema)).to.be.true;",
									"",
									"        pm.environment.set('fileIdToBeDeleted', response.data.id);",
									"    });",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-4368da61-9626-4c42-b817-ead57d8f60e9",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"post\",\n    \"path\": \"/specifications/{{specificationId1}}/files\",\n    \"body\": {\n        \"name\": \"user.yaml\",\n        \"content\": \"new schema\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "List all files",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "27ed2f99-7dd5-437f-9bb3-b46848af8d37",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test(\"Validate file\", function(){",
									"        const responseData = pm.response.json();",
									"",
									"        pm.expect(responseData.data.length).to.eql(2);",
									"        pm.expect(responseData.data[0]).to.have.all.keys('id','name', 'content')",
									"        console.log(responseData);",
									"        console.log(pm.environment.get(\"fileId\"))",
									"",
									"        const targetFileId = pm.environment.get(\"fileId\"),",
									"        file = _.find(responseData.data,{id:targetFileId});",
									"        console.log(file);",
									"",
									"        pm.expect(file.id).to.be.eql(targetFileId);",
									"        pm.expect(file.content).to.be.eql(\"openapi: '3.0.0'\\ninfo:\\n  version: '1.0.0'\\n  title: 'Sample API'\\n  description: Buy or rent spacecrafts\\n\\npaths:\\n  /spacecrafts/{spacecraftId}:\\n    parameters:\\n      - name: spacecraftId\\n        description: The unique identifier of the spacecraft\\n        in: path\\n        required: true\\n        schema:\\n          $ref: '#/components/schemas/SpacecraftId'\\n    get:\\n      summary: Read a spacecraft\\n      responses:\\n        '200':\\n          description: The spacecraft corresponding to the provided spacecraftId\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Spacecraft'\\n        404:\\n          description: No spacecraft found for the provided spacecraftId\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Error'\\n        500:\\n          description: Unexpected error\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Error'\\ncomponents:\\n  schemas:\\n    SpacecraftId:\\n      description: The unique identifier of a spacecraft\\n      type: string\\n    Spacecraft:\\n      type: object\\n      required:\\n        - id\\n        - name\\n        - type\\n      properties:\\n        id:\\n          $ref: '#/components/schemas/SpacecraftId'\\n        name:\\n          type: string\\n        type:\\n          type: string\\n          enum:\\n            - capsule\\n            - probe\\n            - satellite\\n            - spaceplane\\n            - station\\n        description:\\n          type: string\\n    Error:\\n      type: object\\n      required:\\n        - message\\n      properties:\\n        message:\\n          description: A human readable error message\\n          type: string\\n  securitySchemes:\\n    ApiKey:\\n      type: apiKey\\n      in: header\\n      name: X-Api-Key\\nsecurity:\\n  - ApiKey: []\"",
									");",
									"        pm.expect(file.name).to.be.eql(\"index.yml\");",
									"    })",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-6c2bb05c-b50d-451f-a87c-746a871d6e95",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"get\",\n    \"path\": \"/specifications/{{specificationId1}}/files\",\n    \"query\": {\n        \"fields\": \"content,name,id\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Update file content",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "95444af2-779f-4a7d-bb7f-7c66f08f863f",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test(\"validate content\", function () {",
									"        var jsonData = pm.response.json();",
									"",
									"        pm.expect(jsonData).to.be.an('object');",
									"        pm.expect(jsonData.meta).to.be.an('object');",
									"        pm.expect(jsonData.meta).to.have.property('model');",
									"        pm.expect(jsonData.meta).to.have.property('action');",
									"        pm.expect(jsonData.data).to.be.an('object');",
									"        pm.expect(jsonData.data).to.have.property('id');",
									"        pm.expect(jsonData.data).to.have.property('updatedAt');",
									"        pm.expect(jsonData.data).to.have.property('updatedBy');",
									"",
									"    });",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"}"
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-bfdca5bd-6670-44b6-8e7b-4be422b195f0",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"patch\",\n    \"path\": \"/specifications/{{specificationId1}}/files/{{fileId}}\",\n    \"body\": [\n        {\n            \"op\": \"replace\",\n            \"path\": \"/content\",\n            \"value\": \"openapi: '3.0.0'\\ninfo:\\n  version: '1.0.0'\\n  title: 'Sample API'\\n  description: Buy or rent another spacecrafts\\n\\npaths:\\n  /spacecrafts/{spacecraftId}:\\n    parameters:\\n      - name: spacecraftId\\n        description: The unique identifier of the spacecraft\\n        in: path\\n        required: true\\n        schema:\\n          $ref: '#/components/schemas/SpacecraftId'\\n    get:\\n      summary: Read a spacecraft\\n      responses:\\n        '200':\\n          description: The spacecraft corresponding to the provided spacecraftId\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Spacecraft'\\n        404:\\n          description: No spacecraft found for the provided spacecraftId\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Error'\\n        500:\\n          description: Unexpected error\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Error'\\ncomponents:\\n  schemas:\\n    SpacecraftId:\\n      description: The unique identifier of a spacecraft\\n      type: string\\n    Spacecraft:\\n      type: object\\n      required:\\n        - id\\n        - name\\n        - type\\n      properties:\\n        id:\\n          $ref: '#/components/schemas/SpacecraftId'\\n        name:\\n          type: string\\n        type:\\n          type: string\\n          enum:\\n            - capsule\\n            - probe\\n            - satellite\\n            - spaceplane\\n            - station\\n        description:\\n          type: string\\n    Error:\\n      type: object\\n      required:\\n        - message\\n      properties:\\n        message:\\n          description: A human readable error message\\n          type: string\\n  securitySchemes:\\n    ApiKey:\\n      type: apiKey\\n      in: header\\n      name: X-Api-Key\\nsecurity:\\n  - ApiKey: []\"\n        }\n    ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Validate updated file record",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "89574224-cc27-49f7-9017-8b0b6d324623",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    // validate updated record",
									"    // TODO: Fix this",
									"    pm.test(\"Validate updated file\", function(){",
									"        const responseData = pm.response.json();",
									"",
									"        const targetFileId = pm.environment.get(\"fileId\"),",
									"        updatedFile = _.find(responseData.data,{id:targetFileId});",
									"",
									"        pm.expect(updatedFile.id).to.be.eql(targetFileId);",
									"        pm.expect(updatedFile.content).to.be.eql(\"openapi: '3.0.0'\\ninfo:\\n  version: '1.0.0'\\n  title: 'Sample API'\\n  description: Buy or rent another spacecrafts\\n\\npaths:\\n  /spacecrafts/{spacecraftId}:\\n    parameters:\\n      - name: spacecraftId\\n        description: The unique identifier of the spacecraft\\n        in: path\\n        required: true\\n        schema:\\n          $ref: '#/components/schemas/SpacecraftId'\\n    get:\\n      summary: Read a spacecraft\\n      responses:\\n        '200':\\n          description: The spacecraft corresponding to the provided spacecraftId\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Spacecraft'\\n        404:\\n          description: No spacecraft found for the provided spacecraftId\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Error'\\n        500:\\n          description: Unexpected error\\n          content:\\n            application/json:\\n              schema:\\n                $ref: '#/components/schemas/Error'\\ncomponents:\\n  schemas:\\n    SpacecraftId:\\n      description: The unique identifier of a spacecraft\\n      type: string\\n    Spacecraft:\\n      type: object\\n      required:\\n        - id\\n        - name\\n        - type\\n      properties:\\n        id:\\n          $ref: '#/components/schemas/SpacecraftId'\\n        name:\\n          type: string\\n        type:\\n          type: string\\n          enum:\\n            - capsule\\n            - probe\\n            - satellite\\n            - spaceplane\\n            - station\\n        description:\\n          type: string\\n    Error:\\n      type: object\\n      required:\\n        - message\\n      properties:\\n        message:\\n          description: A human readable error message\\n          type: string\\n  securitySchemes:\\n    ApiKey:\\n      type: apiKey\\n      in: header\\n      name: X-Api-Key\\nsecurity:\\n  - ApiKey: []\");",
									"        pm.expect(updatedFile.name).to.be.eql(\"index.yml\");",
									"    })",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-1c7086a9-af86-4515-9caf-4061222d7400",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"get\",\n    \"path\": \"/specifications/{{specificationId1}}/tree\",\n    \"query\": {\n        \"fields\": \"content,path,name,id,fileType,type\"\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				}
			],
			"id": "10497157-31486339-7d59-4658-ab9e-39d476d8e489"
		},
		{
			"name": "Collection syncing",
			"item": [
				{
					"name": "Sync collection",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "6ce16a1d-9492-41b8-b17d-58f67c2e95e1",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 202\", function () {",
									"        pm.response.to.have.status(202);",
									"    });",
									"",
									"",
									"    if (pm.response.code !== 202)  {",
									"        throw 'StatusCode: ' + pm.response.code;",
									"    }",
									"",
									"    pm.test(\"Response has the required fields - 'meta' and 'data'\", function () {",
									"        const responseData = pm.response.json();",
									"        ",
									"        pm.expect(responseData).to.be.an('object');",
									"        pm.expect(responseData).to.have.property('meta');",
									"        pm.expect(responseData).to.have.property('data');",
									"    });",
									"",
									"",
									"    pm.test(\"TaskId in the response data is a non-empty string\", function () {",
									"        const responseData = pm.response.json();",
									"        ",
									"        pm.expect(responseData.data.taskId).to.be.a('string').and.to.have.lengthOf.at.least(1, \"TaskId should be a non-empty string\");",
									"",
									"        pm.environment.set(\"taskId\", responseData.data.taskId);",
									"    });",
									"",
									"",
									"    pm.test(\"Content type is application/json\", function () {",
									"        pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");",
									"    });",
									"    ",
									"",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"    pm.execution.setNextRequest('Delete file');",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-d5756056-152b-43a8-8a69-57de06fc2bed",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"post\",\n    \"path\": \"/specifications/{{specificationId1}}/collections/{{collectionId}}/sync\",\n    \"body\": {}\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "List syncing task status - until finished",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "c3b035eb-e1d2-4efc-bf90-e9009ddc073e",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Response status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test(\"Syncing is successful\", function () {",
									"        var response = pm.response.json();",
									"        pm.expect(response).to.have.property('meta');",
									"        pm.expect(response).to.have.property('data');",
									"        pm.expect(response.meta).to.be.an('object').that.has.property('model');",
									"        pm.expect(response.meta).to.be.an('object').that.has.property('action');",
									"        pm.expect(response.data).to.be.an('object').that.has.property(pm.environment.get('taskId'));",
									"",
									"        const currentRetryCount = Number(pm.environment.get('syncingStatusRetryCount'));",
									"",
									"        if (currentRetryCount > 5) {",
									"            console.log('Exceeded retries');",
									"",
									"            throw 'Exceeded retries';",
									"        } else if (response.data[pm.environment.get('taskId')] === 'in-progress') {",
									"            pm.environment.set('syncingStatusRetryCount', currentRetryCount + 1);",
									"",
									"            pm.execution.setNextRequest('List syncing task status - until finished');",
									"        } else if (response.data[pm.environment.get('taskId')] === 'failed') {",
									"            throw 'Status: failed';",
									"        }",
									"    });",
									"} catch (err) {",
									"    console.log('Error:', err);",
									"    console.log('Response Body', pm.response.text());",
									"",
									"    pm.execution.setNextRequest('Delete file');",
									"} finally {",
									"    pm.environment.set('syncingStatusRetryCount', 0);",
									"}"
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "f58a957e-c0e2-4df2-bd51-239874bb324c",
								"exec": [
									"setTimeout(function() {}, 1000);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"id": "10497157-0e136e0e-eeb5-4858-b221-7da9429fcd60",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"get\",\n    \"path\": \"/tasks?entityId={{collectionId}}&entityType=collection&type=collection-sync\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				}
			],
			"id": "10497157-1074e416-ded9-4f40-8791-ce5a86b0954f"
		},
		{
			"name": "Subscriptions",
			"item": [
				{
					"name": "Create subscription",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "41355a9d-0746-4b51-bfb4-de61418abb1c",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 201\", function () {",
									"        pm.response.to.have.status(201);",
									"    });",
									"",
									"    if (pm.response.code !== 201)  {",
									"        throw 'StatusCode: ' + pm.response.code;",
									"    }",
									"",
									"    pm.test(\"Response is an object with meta and data properties\", function () {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.be.an('object');",
									"        pm.expect(jsonData).to.have.property('meta');",
									"        pm.expect(jsonData).to.have.property('data');",
									"    });",
									"",
									"    pm.test(\"Schema is valid\", function () {",
									"        var schema = {",
									"            type: \"object\",",
									"            properties: {",
									"                meta: {",
									"                    type: \"object\",",
									"                    properties: {",
									"                        action: { type: \"string\" },",
									"                        model: { type: \"string\" }",
									"                    }",
									"                },",
									"                data: {",
									"                    type: \"object\",",
									"                    properties: {},",
									"                    required: []",
									"                }",
									"            },",
									"            required: [\"meta\", \"data\"]",
									"        };",
									"",
									"        var response = pm.response.json();",
									"        pm.expect(tv4.validate(response, schema)).to.be.true;",
									"    });",
									"",
									"",
									"} catch (err) {",
									"    console.log('Error:', err);",
									"    console.log('Response Body', pm.response.text());",
									"}"
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-99a13a65-0f34-4f15-9545-82cf6a6a6a47",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "x-socket-id",
								"value": "test-id",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"post\",\n    \"path\": \"/subscriptions\",\n    \"body\": {\n        \"models\": [\n            {\n                \"id\": \"{{specificationId1}}\",\n                \"type\": \"specification\"\n            }\n        ]\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				}
			],
			"id": "10497157-97a04671-d2f0-471f-b718-758eead499c6"
		},
		{
			"name": "Cleanup",
			"item": [
				{
					"name": "Delete file",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "11d3816e-df40-492a-8a9a-a1ff162d539d",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test(\"Schema is valid\", function () {",
									"    var schema = {",
									"        type: \"object\",",
									"        properties: {",
									"        meta: {",
									"            type: \"object\",",
									"            properties: {",
									"            action: { type: \"string\" },",
									"            model: { type: \"string\" }",
									"            },",
									"            required: [\"action\", \"model\"]",
									"        },",
									"        data: {",
									"            type: \"object\",",
									"            properties: {",
									"            id: { type: \"string\" }",
									"            },",
									"            required: [\"id\"]",
									"        }",
									"        },",
									"        required: [\"meta\", \"data\"]",
									"    };",
									"",
									"    var response = pm.response.json();",
									"    pm.expect(tv4.validate(response, schema)).to.be.true;",
									"    });",
									"",
									"    pm.test(\"Validate response against saved 'id' value\", function () {",
									"        var savedId = pm.environment.get(\"fileIdToBeDeleted\");",
									"        var responseBody = pm.response.json();",
									"        var responseId = responseBody.data.id;",
									"        pm.expect(responseId).to.equal(savedId);",
									"    });",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"}",
									"",
									""
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-61d254b7-e473-48b3-be2f-b83d9485ada9",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"DELETE\",\n    \"path\": \"/specifications/{{specificationId1}}/files/{{fileIdToBeDeleted}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete folder",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "22eb98a6-7265-499f-8f2c-f6c6b1626c5b",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test('Response body is valid', function () {",
									"        const jsonData = pm.response.json();",
									"",
									"        pm.expect(jsonData).to.be.an('object');",
									"        pm.expect(jsonData).to.have.all.keys(['meta', 'data']);",
									"    });",
									"",
									"    pm.test(\"Response body.meta is valid\", function () {",
									"        const jsonData = pm.response.json();",
									"",
									"        pm.expect(jsonData.meta).to.be.an('object');",
									"        pm.expect(jsonData.meta).to.have.property('model', 'SpecificationFolder');",
									"        pm.expect(jsonData.meta).to.have.property('action', 'delete');",
									"    });",
									"",
									"    pm.test(\"Response body.data is valid\", function () {",
									"        var jsonData = pm.response.json();",
									"",
									"        pm.expect(jsonData.data).to.be.an('object');",
									"        pm.expect(jsonData.data).to.have.all.keys('id');",
									"    });",
									"} catch (error) {",
									"    console.log('Error:', err);",
									"    console.log('Response Body', pm.response.text());",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-bd7f3715-0946-453f-994d-6de5335ee65d",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"delete\",\n    \"path\": \"/specifications/{{specificationId1}}/folders/{{spec1FolderId1}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete subscription",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "580099c5-64fc-43fe-88ca-8298ec5aa891",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Status code is 204\", function () {",
									"        pm.response.to.have.status(204);",
									"    });",
									"} catch (err) {",
									"    console.log('Error:', err);",
									"    console.log('Response Body', pm.response.text());",
									"}"
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-b1ace94a-6dd5-4843-9336-8ec6be4e23e1",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "x-socket-id",
								"value": "test-id",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"delete\",\n    \"path\": \"/subscriptions\",\n    \"body\": {\n        \"models\": [\n            {\n                \"id\": \"{{specificationId1}}\",\n                \"type\": \"specification\"\n            }\n        ]\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Update Spec",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "17db5106-bccc-44e0-8121-6d14d03849e1",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Meta and Data objects are present in the response\", function () {",
									"        const responseData = pm.response.json();",
									"",
									"        pm.expect(responseData).to.be.an('object');",
									"        pm.expect(responseData.meta).to.exist.and.to.be.an('object');",
									"        pm.expect(responseData.data).to.exist.and.to.be.an('object');",
									"    });",
									"",
									"    pm.test(\"Data object contains all required keys\", function () {",
									"    const responseData = pm.response.json();",
									"    ",
									"    pm.expect(responseData.data).to.be.an('object');",
									"    pm.expect(responseData.data).to.include.all.keys('id', 'type', 'name', 'description', 'createdBy', 'updatedBy', 'createdAt', 'updatedAt');",
									"    });",
									"",
									"    pm.test('Data object should contain updated name', function () {",
									"        var responseData = pm.response.json();",
									"        pm.expect(responseData).to.be.an('object');",
									"        pm.expect(responseData.data.name).to.be.equal('Updated name');",
									"    });",
									"",
									"} catch (error) {",
									"    console.log('Error:', error);",
									"    console.log('Response Body', pm.response.text());",
									"}"
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-190e4179-9f3c-49f2-bc7c-a6e5590bb140",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"patch\",\n    \"path\": \"/specifications/{{specificationId1}}\",\n    \"body\": [\n        {\n            \"op\": \"replace\",\n            \"path\": \"/name\",\n            \"value\": \"Updated name\"\n        }\n    ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete Spec",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "8fa425f1-d12a-4cb9-ab34-0544b4c78b4e",
								"exec": [
									"try {",
									"    const apiBuilderRequestRetryScript = pm.require('@postman/api-builder-request-retry-script');",
									"",
									"    if (apiBuilderRequestRetryScript.retryOnFailure()) {",
									"        // We don't want to run further assertions since this request will be retried because >500 (e.g 502, 504) response code was received.",
									"        return;",
									"    }",
									"",
									"    pm.test(\"Response time is within 5 seconds\", function () {",
									"        pm.expect(pm.response.responseTime).to.be.below(5000);",
									"    });",
									"",
									"    pm.test(\"Status code is 200\", function () {",
									"        pm.response.to.have.status(200);",
									"    });",
									"",
									"    pm.test(\"Schema is valid\", function () {",
									"    var schema = {",
									"        type: \"object\",",
									"        properties: {",
									"        meta: {",
									"            type: \"object\",",
									"            properties: {",
									"            action: { type: \"string\" },",
									"            model: { type: \"string\" }",
									"            },",
									"            required: [\"action\", \"model\"]",
									"        },",
									"        data: {",
									"            type: \"object\",",
									"            properties: {",
									"            id: { type: \"string\" }",
									"            },",
									"            required: [\"id\"]",
									"        }",
									"        },",
									"        required: [\"meta\", \"data\"]",
									"    };",
									"",
									"    var response = pm.response.json();",
									"    pm.expect(tv4.validate(response, schema)).to.be.true;",
									"    });",
									"",
									"    // Test for response against saved value",
									"    pm.test(\"Validate response against saved 'id' value\", function () {",
									"        var savedId = pm.environment.get(\"specificationId1\");",
									"        var responseBody = pm.response.json();",
									"        var responseId = responseBody.data.id;",
									"        pm.expect(responseId).to.equal(savedId);",
									"    });",
									"} catch (err) {",
									"    console.log('Error:', err);",
									"    console.log('Response Body', pm.response.text());",
									"}"
								],
								"type": "text/javascript",
								"packages": {
									"@postman/api-builder-request-retry-script": {
										"id": "019491be-1f51-7e13-b196-4e4fec49649f"
									}
								}
							}
						}
					],
					"id": "10497157-55a7a4f9-7c14-4374-a8f2-9de424614a0d",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"service\": \"specification\",\n    \"method\": \"delete\",\n    \"path\": \"/specifications/{{specificationId1}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{bifrostProxyUrl}}",
							"host": [
								"{{bifrostProxyUrl}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete a collection",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "376f844a-ab40-43dc-a8aa-f60457855da2",
								"exec": [
									"",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"id": "10497157-4c95d0a1-d272-4e12-bce2-13f6345cf162",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{bifrostHost}}/collection/{{collectionId}}",
							"host": [
								"{{bifrostHost}}"
							],
							"path": [
								"collection",
								"{{collectionId}}"
							]
						},
						"description": "Generated from cURL: curl --location --globoff --request DELETE '{{baseUrl}}/collection/694899-ea8013be-34a1-4e3a-8bb4-15dc423e220d'"
					},
					"response": []
				}
			],
			"id": "10497157-dfcfcdd4-2a65-4d33-897f-7fbb13139775"
		}
	],
	"auth": {
		"type": "apikey",
		"apikey": [
			{
				"key": "value",
				"value": "{{userToken}}",
				"type": "string"
			},
			{
				"key": "key",
				"value": "x-access-token",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "6ae067d4-37c4-4e68-b2d1-976ea2595062",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "f2490ae1-64ce-4f3e-9ffe-6286ed12c6bd",
				"type": "text/javascript",
				"exec": [
					"if (pm.response.code >= 500) {",
					"    console.log('Response code: ', pm.response.code);",
					"    console.log('Response body: ', pm.response.text());",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "https://api-specification.postman-beta.tech",
			"type": "string"
		}
	]
}